<div class="example-container flex-1 flex-column" cdkDropListGroup>
  <form [formGroup]="activityForm" (ngSubmit)="submitResult(activityForm.value)" class="margin-top-xs">
    <div *ngIf="false" class=" flex flex-1 flex-row resporow">
      <div class="flex flex-1 flex-column example-list margin-r-2px">
        <span class="flex margin-left-m mat-subheading-2 margin-top-s">
          {{'Role and description'}}
        </span>
        <span class="flex margin-left-m mat-subheading-2 ws-mat-black60-text">
          {{'Unmapped activities'}}
        </span>
      </div>
      <div class="flex flex-4 flex-column example-list">
        <div class="flex flex-1">
          <div class="flex flex-2 min-w-200">
            <span class="flex mat-subheading-2 margin-top-xs margin-left-s">
              <mat-icon class="ws-mat-black40-text margin-right-s">directions_walk</mat-icon>
              Activities
            </span>
          </div>
          <div class="custom-w">&nbsp;</div>
          <div class="flex flex-1">
            <span class="flex mat-subheading-2 margin-top-xs">Submit to
              <mat-icon class="ws-mat-black40-text margin-left-s">info</mat-icon>
            </span>

          </div>
        </div>
        <div id="labels" cdkDropList (cdkDropListDropped)="drop($event)" [cdkDropListData]="labelsList.value"
          [cdkDropListEnterPredicate]="noReturnPredicate">
          <!-- <ng-container *ngIf="activityForm.get('labelsArray').value"> -->
          <ng-container *ngFor="let _activity of activityForm.get('labelsArray').controls; let i = index">
            <div [attr.id]="'roww_'+i+ '_'" class="example-box" [cdkDragData]="_activity.value" cdkDrag>
              <div class="margin-right-xs">
                <mat-icon class="ws-mat-black40-text">drag_indicator</mat-icon>
              </div>
              <div class="flex flex-1" [formGroup]="_activity">
                <div class="flex flex-2 margin-2px">
                  <mat-form-field appearance="outline" class="full-width no-pb square outline-color">
                    <input [attr.id]="'actDesc_' + i" matInput #actDesc formControlName="activityDescription"
                      i18n-placeholder placeholder="Type here" i18n-aria-label aria-label="Activity name input"
                      class="form-input flex-1" autocomplete="off" />
                  </mat-form-field>
                </div>
                <div class="flex flex-1 margin-2px">
                  <mat-form-field appearance="outline" class="full-width no-pb square outline-color">
                    <input [attr.id]="'assignto_' + i" matInput #assignto formControlName="assignedTo" i18n-placeholder
                      placeholder="Type here" i18n-aria-label aria-label="Activity description input"
                      class="form-input flex-1" autocomplete="off" />
                  </mat-form-field>
                </div>

              </div>
            </div>
          </ng-container>
          <!-- </ng-container> -->
        </div>
        <div class="flex flex-1">
          <div class="custom-w">&nbsp;</div>
          <a href="javascript:void(0)" class="flex padding-s" (click)="addNewLabel()">
            <mat-icon class="ws-mat-black60-text">add</mat-icon>
            <span class="mat-subheading-2 ws-mat-black60-text">Activity</span>
          </a>
        </div>
      </div>
    </div>
    <!-- <div *ngIf="groups.length > 0" class="flex flex-1 flex-column margin-top-xs"> -->
    <ng-container *ngFor="let grp of activityForm.get('groupsArray').controls; let i=index">
      <div (mouseenter)="enter(i)" class=" flex flex-1 flex-row resporow margin-top-xs" [formGroup]="grp">
        <div *ngIf="i === 0" class="flex flex-1 flex-column example-list margin-r-2px">
          <span class="flex margin-left-m mat-subheading-2 margin-top-s">
            {{'Role and description'}}
          </span>
          <span class="flex margin-left-m mat-subheading-2 ws-mat-black60-text">
            {{'Unmapped activities'}}
          </span>
        </div>
        <div *ngIf="i !==0 " class="flex flex-1 flex-column margin-r-2px">
          <div class="flex flex-1 group-background margin-b-2px" (focusout)="hideName()">
            <span
              *ngIf="(canshowName === -1 && !grp.get('groupName').value) || !(canshowName === i && activeGroupIdx === i) "
              (click)="showName(i)" class="flex margin-left-m  margin-top-m mat-subheading-2 break-a">
              {{grp.get('groupName').value || 'Untited role'}}
            </span>
            <mat-form-field *ngIf="canshowName === i && activeGroupIdx === i" appearance="outline"
              class="full-width no-pb square outline-color">
              <input [attr.id]="'roleName_' + i" formControlName="groupName" matInput #roleName i18n-placeholder
                placeholder="Type here" onfocus="this.select()" i18n-aria-label aria-label="Activity name input"
                class="form-input flex-1" autocomplete="off" />
            </mat-form-field>
          </div>
          <!-- {{grp.get('groupName').value}} -->
          <div class="flex flex-1 group-background " (focusout)="hide()">
            <span
              *ngIf="(canshow === -1 && !grp.get('groupDescription').value) || !(canshow === i && activeGroupIdx === i)"
              (click)="show(i)" class="flex margin-left-m  margin-top-m mat-body-2 ws-mat-black40-text break-a">
              {{grp.get('groupDescription').value || 'Role description'}}
            </span>
            <mat-form-field *ngIf="canshow === i && activeGroupIdx === i" appearance="outline"
              class="full-width no-pb square outline-color ">
              <textarea [attr.id]="'roleDesc_' + i" matInput #roleDesc name="questionText" cols="35" rows="8"
                placeholder="Type here" formControlName="groupDescription" i18n-aria-label
                aria-label="role description input" onfocus="this.select()"></textarea>
            </mat-form-field>
          </div>
        </div>
        <div class="flex-4" [ngClass]="{ 'group-background' : i !== 0, 'example-list': i === 0}">
          <div *ngIf="i === 0" class="flex flex-1">
            <div class="flex flex-2 min-w-200">
              <span class="flex mat-subheading-2 margin-top-xs margin-left-s">
                <mat-icon class="ws-mat-black40-text margin-right-s">directions_walk</mat-icon>
                Activities
              </span>
            </div>
            <div class="custom-w">&nbsp;</div>
            <div class="flex flex-1">
              <span class="flex mat-subheading-2 margin-top-xs">Submit to
                <mat-icon class="ws-mat-black40-text margin-left-s">info</mat-icon>
              </span>

            </div>
          </div>
          <div [id]="'compe_' + i" cdkDropList [cdkDropListData]="groupActivityList"
            (cdkDropListDropped)="dropgroup($event)" [cdkDropListEnterPredicate]="evenPredicate"
            class="flex-1 margin-top-s min-w">
            <ng-container *ngFor="let ga of grp.get('activities').controls; let gaIdx = index">
              <!-- {{log(ga)}} -->
              <!-- <span class="mat-subheading-2">{{'Unmapped activities'}}</span> -->
              <div [attr.id]="'cdkDragData_' + gaIdx" class="example-box" [cdkDragData]="ga.value" cdkDrag>
                <div class="margin-right-xs">
                  <mat-icon class="ws-mat-black40-text">drag_indicator</mat-icon>
                </div>
                <div class="flex flex-1" [formGroup]="ga">
                  <div class="flex flex-2 margin-2px">
                    <mat-form-field appearance="outline" class="full-width no-pb square outline-color">
                      <input [attr.id]="'actDesc_' + gaIdx" formControlName="activityDescription" matInput #actDesc
                        i18n-placeholder placeholder="Type here" i18n-aria-label aria-label="Activity name input"
                        class="form-input flex-1" autocomplete="off" />
                    </mat-form-field>
                  </div>
                  <div class="flex flex-1 margin-2px">
                    <mat-form-field appearance="outline" class="full-width no-pb square outline-color">
                      <!-- <input [attr.id]="'assignto_' + gaIdx" matInput #assignto i18n-placeholder placeholder="Type here"
                        i18n-aria-label aria-label="Activity description input" class="form-input flex-1"
                        autocomplete="off" /> -->
                      <input [attr.id]="'assignto_' + gaIdx" class="form-input flex-1" matInput #OfficerName
                        formControlName="assignedTo" i18n-placeholder placeholder="Type here" i18n-aria-label
                        aria-label="Type here" [wsAppAutocomplete]="autocomplete"
                        (input)="filterUsers(assignedTo.value)" autocomplete="off">
                    </mat-form-field>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
          <div class="flex flex-1">
            <div class="custom-w1">&nbsp;</div>
            <a href="javascript:void(0)" class="flex padding-s padding-left-0" (click)="addNewGroupActivity(i)">
              <mat-icon class="ws-mat-black60-text">add</mat-icon>
              <span class="mat-subheading-2 ws-mat-black60-text margin-0">Activity</span>
            </a>
          </div>
        </div>
      </div>
    </ng-container>
    <!-- </div> -->
    <div class="flex flex-1">
      <!-- <div class="custom-w">&nbsp;</div> -->
      <a href="javascript:void(0)" class="flex padding-s" (click)="addNewGroup()">
        <mat-icon class="ws-mat-black60-text">add</mat-icon>
        <span class="mat-subheading-2 ws-mat-black60-text">Role</span>
      </a>
    </div>

    <!-- <pre> -->
    <!-- {{getActivityForm}} -->
    <!-- </pre> -->
  </form>
</div>

<ws-app-autocomplete #autocomplete="wsAppAutocomplete">
  <ng-template wsAppAutocompleteContent>
    <ng-container *ngIf="(userslist | filter: groupDescription.value) as result">
      <div class="mat-body-4 ws-mat-accent-text margin-bottom-xs">From Karmayogi officer portal</div>
      <ws-app-option *ngFor="let user of userslist"
        [value]="user.userDetails.first_name +' '+ user.userDetails.last_name">
        <div class=" mat-accent-border" (click)="OfficerClicked(user)">
          <div class="padding-top-m ">
            <span
              class="letter-color">{{user.userDetails.first_name.charAt(0)}}{{user.userDetails.last_name.charAt(0)}}</span>
            <mat-icon class="groupicon ws-mat-accent-text ws-mat-accent-border">group</mat-icon>
          </div>
          <div class="padding-top-xs padding-bottom-xs ">
            <p class="username mat-body-2 font-bold-i margin-bottom-xxs">{{user.userDetails.first_name}}
              {{user.userDetails.last_name
              ?
              user.userDetails.last_name : ''}}</p>
            <p class="useremail mat-body-2 margin-bottom-xxs">{{user.userDetails.email}}</p>
            <p class="userpos mat-body-2 ws-mat-black60-text margin-bottom-xs margin-bottom-xxs">
              Software Engineer at Tarento
              {{user.userDetails.position ?
              user.userDetails.position : ''}}
              <span *ngIf="user.userDetails.department_name">at</span> {{user.userDetails.department_name}}
            </p>
          </div>
        </div>
      </ws-app-option>
      <ws-app-option class="no-result" *ngIf="!result.length">No result...</ws-app-option>
    </ng-container>
  </ng-template>
</ws-app-autocomplete>